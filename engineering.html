<!DOCTYPE HTML>

<html>
	<head>
		<title>BO859545</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="assets/css/sec.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>

		<style>
		

		</style>
		
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<a href="index.html" class="logo"><strong>bo</strong> <span>859545</span></a>
						<nav>
							<a href="#menu">Menu</a>
						</nav>
					</header>

				<!-- Menu -->
					<nav id="menu">
						<ul class="links">
							<li><a href="index.html">Home</a></li>
							<li><a href="engineering.html">Engineering</a></li>
							<li><a href="reporting.html">Reporting</a></li>
							<li><a href="python.html">Programming</a></li>
							<li><a href="visualization.html">Visualization</a></li>
							<li><a href="ml.html">Machine Learning</a></li>
							<li><a href="big-data.html">Big Data</a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main" class="alt">

						<!-- One -->
							<section id="one" style="background-color: white;">
								<div class="inner">
									<header class="major" style="margin: 0 auto;">
										 
										<nav id="sub-menu">
											<ul class="tertiary-nav" style="margin: auto 0;">
												<li><a href="engineering.html">Airflow</a></li>
												<li><a href="dagster.html">Dagster</a></li>
												<li><a href="template.html">AWS Glue</a></li>
												<li><a href="template.html">Azure Data Factory</a></li>
											</ul>
										</nav>
	
										<h2 style="color: #949494; text-align:center; margin-bottom: 0;" id="content">Building Data Pipeline</h2>
										<h3 style="color: #949494; text-align:center; margin-bottom: 0;" id="content">Set Up - Apache Airflow</h3>
										
									</header>

									<p style="color: #545454; width: 70%; margin: 50px auto; text-align: justify; font-size: 19px;">This project demonstrates the implementation of a modern data stack and the development of a robust data pipeline for a retail company, Adventure Works. It leverages a combination of Python for writing elt/etl scripts, Apache Airflow for orchestration, BigQuery, Snowflake, AWS Redshift for storage, dbt for transformation and AWS Airflow Managed Instance for production to efficiently move data from PostgreSQL database to an OLAP system.
										<!-- This end-to-end solution demonstrates best practices in data engineering and modern data management. -->
									</p>

									<!-- Content -->
											
										<pre class="py-code">
											<code style="margin: 0; padding: 0;">
		<span class="code-comment"># Apache Airflow - Local Set-Up</span>
		$ python3 -m venv airflow-env <span class="code-comment"> # create virtual environment</span>
		$ source airflow-env/bin/activate <span class="code-comment"> # activate virtual environment</span>
		$ export AIRFLOW_HOME=~/airflow 
		$ pip install apache-airflow
		$ airflow db init
		$ airflow webserver -p 8080 <span class="code-comment">#launch webserver</span>
		$ airflow sheduler <span class="code-comment">#launch scheduler</span>
												</code>
											</pre>

									<h3 style="color: #949494; text-align:center; margin-bottom: 0;" id="content">Airflow Weberver UI</h3>
									<a href="images/ingestion.png" target="_blank"><img class="image" src="images/Pasted image (2).png"/></a>
									<a href="images/IV.png" target="_blank"><img class="image"src="images/IV.png" alt=""/></a>
									<a href="images/XI.png" target="_blank"><img class="image" src="images/XI.png" alt="" /></a>

										<pre class="py-code">
											<code style="margin: 0; padding: 0;">
		<span class="code-comment"># installing dependencies</span>
		pip install google-cloud-bigquery
		pip install --upgrade snowflake-connector-python
											</code>
										</pre>

										<pre class="py-code">
											<code style="margin: 0; padding: 0;">
		<span class="code-comment"># importing libraries</span>
		<span class="py-method">from</span> airflow.decorators <span class="py-method">import</span> dag, task
		<span class="py-method">from</span> datetime <span class="py-method">import</span> datetime, timedelta
		<span class="py-method">from</span> google.cloud <span class="py-method">import</span> bigquery
		<span class="py-method">import</span> pandas <span class="py-method">as</span> pd
		<span class="py-method">import</span> psycopg2
											</code>
										</pre>

								

									<pre class="py-code">
										<code style="margin: 0; padding: 0;">
		<span class="code-comment"># defining a dag - Direct Acyclic Graph</span>
		args{
			<span class="code-text">”owner”</span> : <span class="code-text">BO859545</span> ,
			<span class="code-text">"retries"</span>: 1,
			<span class="code-text">"retry_delay"</span>:timedelta(minutes=5)
			}

		<span class="airflow-call">@dag</span>(
			default_arguments = args
			Schedule=timedelta(minutes=30),
			start_date=datetime(2024, 7, 29),
			catchup= <span class="code-func">False</span>,
			tags=[<span class="code-text">'DataOps Team'</span>]
			)
										</code>
									</pre>

									<pre class="py-code">
										<code style="margin: 0; padding: 0;">
		<span class="code-comment"># Task One - get tables</span>
		<span class="airflow-call">@task()</span>
		<span class="code-func">def</span> get_tables <span class="code-func">()</span>:
		<span class="code-text">"""extract list of tables in public schema"""</span>
		
		<span class="py-method">try</span>:
			cursor.execute(
				f <span class="code-text">"""SELECT table_name 
				FROM information_schema.tables 
				WHERE table_schema = 'public'"""</span> 
			)
		
		tbls = [x[0] for x in cursor.fetchall()]
				
										</code>
									</pre>

									<pre class="py-code">
										<code style="margin: 0; padding: 0;">
		<span class="code-comment"># Task Two - extract_load</span>
		<span class="airflow-call">@task()</span>
		<span class="code-func">def</span> extract_load(tbls, conn):
		<span class="code-text">"""this task loops through tbls returned from previous task,
		extract all columns from each tbl where the column updated
		at >= {ds}, last execution date then loads the data"""</span>

			client = bigquery.Client()
			job_config = bigquery.LoadJobConfig(
			write_disposition= <span class="code-text">"WRITE_TRUNCATE"</span>)

			<span class="py-method">for</span> tbl in tbls:
			table_id = f<span class="code-text">"adventureworks-431609.stg.</span>{tbl}<span class="code-text">"</span>
			sql = f"<span class="code-text">SELECT * FROM {tbl} WHERE 
				updated_at >= {ds}'"</span>
			df = pd.read_sql(sql, conn)

			job = client.load_table_from_dataframe(
			df, table_id, job_config=job_config)
			job.result()

			get_tables = get_tables()
			extract_load = extract_load(get_tables)
				
										</code>
									</pre>

									<h3 style="color: #949494; text-align:center; margin-bottom: 0;" id="content">Running Pipeline</h3>
									<a href="images/VIII.png" target="_blank"><img class="image" src="images/VIII.png" alt="" /></a>
									<a href="images/XII.png" target="_blank"><img class="image" src="images/XII.png" alt="" /></a>
									<h3 style="color: #949494; text-align:center; margin-top: 70px; margin-bottom: 0;" id="content">Running dbt Models</h3>
									<a href="images/XIII.png" target="_blank"><img class="image" src="images/XIII.png" alt="" /></a>
								
					</div>

				<!-- Contact -->
					<!-- <section id="contact">
						<div class="inner">
							<section>
								<form method="post" action="#">
									<div class="fields">
										<div class="field half">
											<label for="name">Name</label>
											<input type="text" name="name" id="name" />
										</div>
										<div class="field half">
											<label for="email">Email</label>
											<input type="text" name="email" id="email" />
										</div>
										<div class="field">
											<label for="message">Message</label>
											<textarea name="message" id="message" rows="6"></textarea>
										</div>
									</div>
									<ul class="actions">
										<li><input type="submit" value="Send Message" class="primary" /></li>
										<li><input type="reset" value="Clear" /></li>
									</ul>
								</form>
							</section>
							<section class="split">
								<section>
									<div class="contact-method">
										<span class="icon solid alt fa-envelope"></span>
										<h3>Email</h3>
										<a href="#">information@untitled.tld</a>
									</div>
								</section>
								<section>
									<div class="contact-method">
										<span class="icon solid alt fa-phone"></span>
										<h3>Phone</h3>
										<span>(000) 000-0000 x12387</span>
									</div>
								</section>
								<section>
									<div class="contact-method">
										<span class="icon solid alt fa-home"></span>
										<h3>Address</h3>
										<span>1234 Somewhere Road #5432<br />
										Nashville, TN 00000<br />
										United States of America</span>
									</div>
								</section>
							</section>
						</div>
					</section> -->

				<!-- Footer -->
					<!-- <footer id="footer">
						<div class="inner">
							<ul class="icons">
								<li><a href="#" class="icon brands alt fa-twitter"><span class="label">Twitter</span></a></li>
								<li><a href="#" class="icon brands alt fa-facebook-f"><span class="label">Facebook</span></a></li>
								<li><a href="#" class="icon brands alt fa-instagram"><span class="label">Instagram</span></a></li>
								<li><a href="#" class="icon brands alt fa-github"><span class="label">GitHub</span></a></li>
								<li><a href="#" class="icon brands alt fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
							</ul>
							<ul class="copyright">
								<li>&copy; Untitled</li><li>Design: <a href="https://html5up.net">HTML5 UP</a></li>
							</ul>
						</div>
					</footer>

			</div> -->

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>